**Notes**: These rules below are important rules for anyone who participate in writing/reviewing/testing this app
- Append `./progress.md` upon noticeable changes.
- **UI & Layout**:
  - Always use `SafeAreaView` for components at the bottom of the screen to accommodate Android navigation bars.
  - For UI texts, prioritize brevity and icons.
  - Use preset colors defined in `themes/index.ts`. Use `toRgb()`/`toRgba()` helpers.
  - **New Colors**: Added `--accent-pink` and `--accent-orange` for hobby tags and highlights.
  - **Images**: Use `expo-image` (`<Image>`) instead of React Native's Image for caching and performance.
- **Performance**:
  - **Image Preloading**: For feed or swipe interfaces (e.g., `ExploreSwipeScreen`), preload images in advance using `Image.prefetch()`. This is critical for a smooth UX and is managed centrally in `RecommendationContext`.
- **Internationalization (i18n)**:
  - All text must be in `i18n/translations.ts` (English, Japanese, Vietnamese).
  - Group keys logically (e.g., `settings.hobbies`, `explore.filters`).
- **State & Data**:
  - **Privacy First**: Never store sensitive user traits (Big 5 scores, hobbies) in plaintext. Always encrypt via `score-crypto` before saving to `public.profiles`.
  - **Hobbies**: Use `hobbies_cipher` for storage and `hobby_embedding` for matching. Do not use the deprecated `hobbies` plaintext column.
  - **Vectors**: Use the `embed` edge function to generate vectors.
  - **Data Integrity**: When updating profiles, always strip `undefined` keys from the payload to prevent overwriting existing DB columns with `NULL`. Use the utility in `UserSettingsScreen.tsx` as a reference.
- **Real-time & Global State**:
  - **Zustand**: Use centralized stores (`store/`) for highly dynamic data (Messages, Notifications). Avoid local `useState` for data that needs to sync across tabs.
  - **Realtime Manager**: All Supabase subscriptions MUST be managed by the `RealtimeManager` singleton. Screens should not subscribe to channels directly.
  - **Optimistic Updates**: UI should update instantly upon user action (e.g., sending a message, marking read). Sync with the backend in the background and handle errors gracefully by updating the store state.
  - **Cleanup**: Always call `reset()` on all stores and `disconnect()` on `RealtimeManager` when the user logs out to prevent cross-account data leakage.
- **Package Management**:
  - Use Yarn.
  - Do not run `npm start` or app builds during coding tasks unless explicitly requested.
- **Backend (Supabase)**:
  - Keep `Documents/supabase.md` and `Documents/supbabase_current_schema.md` updated.
  - Use `npx supabase` CLI for migrations.
  - **Edge Functions**: Deploy functions individually (`npx supabase functions deploy <name>`).
- **Haptics**: Add snappy haptics for navigation buttons.
- **After Adding feature**: 
    - Run yarn tsc --noEmit for type checking 
    - Use gitlog to apply correct commit format, one implementation at a time, if functional request is too big, split it in smaller tasks, do one at a time, wait for manual testing/give instructions if there are manual deployment or migration that you cannot directly do (ideally you should also do the database actions in psql or npx supabase cli) until they all work before commiting and moving on to the next task, if tasks are not done, keep reminding un-finished tasks if there are more requests ushing in.
